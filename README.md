# Termp-Humi-Recorder
Tuya&amp;Lceda Camp Project,Termp&amp;Humi Recorder
===
This project is developed using T uya SDK, which enables you t o quickly develop branded apps connect ing and cont rolling smart scenarios of many devices.For more inf ormat ion, please check T uya Developer Websit e.
==
【涂鸦智能】多参数环境空气质量监测记录仪。采集环境参数“温度-湿度-光照度-大气压-二氧化碳-TVOC”，采用断码LCD或者3.5寸TFT-LCD显示；两节18650电池供电，通过USB充电；通过WB3S模块将环境实时数据传输到涂鸦后台，通过手机APP可以实时监测环境数据；通过FLASH存储环境参数数据。
==
一、硬件部分
=====
1、单片机最小系统。
-----
实际焊接芯片为STM32F103CBT6。STM32价格暴涨，无奈比较熟悉，咬咬牙忍了，下次争取有机会换成国产芯片。

2、电源转换模块。
-----
5V转3.3V，万年不变的AMS1117-3.3，别问我为什么，看看立创商城它的销量就知道。（窍门：不知道如何选芯片，就上立创商城看同类型芯片销量最高的那几款！！！）

3、EEPROM。
-----
采用AT24C04，IIC总线驱动，经典芯片，存储系统参数。

4、按键模块。
-----
四个功能按键，实际只用了KEY1作为配网按键，其它三个按键程序没有来得及写。

5、WIFI模块。
-----
WB3S模块，上次训练营用过，这次直接拿过来了，BLE&WIFI双模，配网方便！这次用的是MCU的SDK开发模式。

6、FLASH存储器。
-----
用于存储环境监测参数，本来打算做文件系统FATFS，结果时间紧迫，来不及了，只是测试了FLASH的存储功能。

7、传感器部分。
-----
所有传感器都是IIC接口，挂接在同一总线上，还预留了外接传感器接口CN1和H7，只要是3.3V供电、IIC接口的器件都可以接在上面进行测试。

（1）温湿度传感器。SHTC3，盛世瑞恩的芯片，牛X的很，高精度，低功耗。

（2）光照传感器。OPT3001，第一次用，立创商城找的，嘉立创可以贴片焊接，所以选了它。

（3）TVOC传感器。SGP40，新出的一款替代SGP30，也是盛世瑞恩的芯片，不过需要订货，没来得及调试，用了以前的SGP30，可以监测TVOC和二氧化碳，注意SGP30是1.8V供电，用的时候一定要做电平转换电路。

（4）大气压力传感器。SPL06-007，监测大气压力，同时可以计算出海拔高度。第一次用，不知道准不准。

8、段码液晶屏。
-----
选这个液晶的目的，是因为其有配套的外壳。不懂3D打印，所以只能买成品共模外壳，调了好久，最终选择了它，40元一套，外壳+显示屏，有点小贵。听说有外壳才容易获奖，咬牙忍了。
采用了HT1622驱动段码液晶屏，AW9364作为背光调节（不过没有调试成功，只能等待以后了，尴尬！）

9、锂电池充放电管理。
-----
采用IP5306这个芯片，参考了开源平台其它高手的设计，还算成功。不过想通过充放电指示灯的三个控制管脚检测电池电量，没有成功！

10、3.5寸TFT液晶接口。预留接口，可以外接TFT液晶屏，没有时间调试!
-----

二、软件部分
=====
1、RTC驱动调试。根据正点原子程序进行修改，这个难度不大，电路没有问题的话，很容易调试成功。参考代码件附件：29270W-RTC实验-OK.rar。
-----
2、AT24C04驱动程序。软件模拟IIC实现，参考正点原子代码，简单修改，测试成功。参考代码件附件：29270W-AT24C04-OK.rar。
-----
3、FLASH驱动程序。SPI读写FLASH，参考正点原子代码，测试成功!!! 参考代码件附件：29270W-SPI+FLASH-OK.rar。
-----
4、SHTC3驱动程序。软件IIC读取，参考网络代码，进行修改，测试成功! 参考代码件附件：29270W-I2C-SHTC3-OK.rar。
-----
5、OPT3001驱动程序。软件IIC读取，参考网络代码，进行修改，测试成功! 参考代码件附件：29270W-OPT3001-OK.rar。
-----
6、SPL006驱动程序。软件IIC读取，参考网络代码，进行修改，测试成功! 参考代码件附件：29270W-SPL06-OK.rar。
-----
7、SGP30驱动程序。软件IIC读取，参考网络代码，进行修改，测试成功! 参考代码件附件：29270W-SGP30-OK.rar。
-----
8、HT1622段码液晶驱动程序。参考代码附件：29270W-HT1622-OK.rar。
-----
9、WB3S模块驱动移植。只写几个关键的点。
-----
（1）配网。主程序调用，按键KEY1按下时，启动配网。
（2）获取配网状态，可以根据返回值，编写具体的函数。
（3）更新实时数据。
主程序每10秒调用一次，更新环境监测数据进行上传，定时器定时500毫秒。
all_data_updata()函数的具体实现在protocol.c，这个很关键！！！


三、过程图片
====
1、嘉立创制作+SMT照片
-----
2、温湿度显示
-----
3、大气压力+海拔高度
-----
4、二氧化碳+环境光照
-----
5、TVOC显示
-----
6、电池插片
-----
7、安装电池
-----
8、成品正面
-----
9、成品背面
-----
三、总结
====
1、感谢涂鸦智能&立创EDA的大力支持，学到了很多东西，物联网真的不难，只要肯下功夫，一个假期收获满满。
-----
2、电路设计方面采用了很多新的东西，做了一些尝试，有成功，也有遗憾。以后的设计中还需要多加验证，多采用成熟方案，避免走弯路。
-----
3、程序设计方面还差很多，很多程序直接从网上拿来就用，形成了惯性思维，解决复杂问题的能力还需要有待提高。
-----
4、认识了很多朋友，非常开心，希望下次活动和大家一起加油！！！
-----

工程链接：https://oshwhub.com/xiezhaoyan/wen-shi-du-ji-lu-yi
